<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<!-- Created using eXe: http://exelearning.org -->
<head>
<link rel="stylesheet" type="text/css" href="base.css" /><link rel="stylesheet" type="text/css" href="content.css" /><link rel="stylesheet" type="text/css" href="nav.css" /><title>6.1 - PG_DUMP </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/html;  charset=utf-8" />
<script type="text/javascript" src="common.js"></script>
</head>
<body>
<div id="content">
<div id="emptyHeader"></div><div id="siteNav">
<ul>
<li><a href="index.html" class="daddy main-node">Administración de PostgreSQL</a></li><li><a href="1__instalacin.html" class="no-ch">1 - Instalación</a></li>
<li><a href="nota_previa.html" class="no-ch">Nota Previa</a></li>
<li><a href="2_arranque_y_parada_del_sistema.html" class="no-ch">2. Arranque y parada del sistema</a></li>
<li><a href="3__ficheros_de_configuracin.html" class="no-ch">3 - Ficheros de configuración</a></li>
<li><a href="4__gestin_de_usuarios_y_privilegios.html" class="daddy">4 - Gestión de usuarios y privilegios</a><ul class="other-section">
<li><a href="41__gestin_de_roles_utilizacin_como_usuarios.html" class="no-ch">4.1 - Gestión de roles: utilización como usuarios</a></li>
<li><a href="42__gestin_de_roles_utilizacin_como_grupos.html" class="no-ch">4.2 - Gestión de roles: utilización como grupos</a></li>
<li><a href="43__permisos.html" class="no-ch">4.3 - Permisos</a></li>
<li><a href="44__roles_y_miembros.html" class="no-ch">4.4 - Roles y miembros</a></li>
<li><a href="45__autenticacin_de_usuarios.html" class="no-ch">4.5 - Autenticación de usuarios</a></li>
</ul>
</li>
<li><a href="5__gestin_de_bases_de_datos.html" class="daddy">5 - Gestión de Bases de Datos</a><ul class="other-section">
<li><a href="51__bases_de_datos_creacin_modificacin_y_eliminacin.html" class="no-ch">5.1 - Bases de Datos: Creación, Modificación y Eliminación</a></li>
<li><a href="52__esquemas.html" class="no-ch">5.2 - Esquemas</a></li>
<li><a href="53__tablespaces.html" class="no-ch">5.3 - Tablespaces</a></li>
<li><a href="54_lugares_alternativos.html" class="no-ch">5.4 Lugares alternativos</a></li>
</ul>
</li>
<li class="current-page-parent"><a href="6_copia_de_seguridad_y_restauracin.html" class="current-page-parent daddy">6- Copia de seguridad y restauración</a><ul>
<li id="active"><a href="61__pg_dump.html" class="active no-ch">6.1 - PG_DUMP</a></li>
<li><a href="62__restauracin_del_dump.html" class="no-ch">6.2 - Restauración del DUMP</a></li>
<li><a href="63__backup_desde_pgadmin.html" class="no-ch">6.3 - Backup desde PgAdmin</a></li>
<li><a href="64__backup_por_copia_de_ficheros.html" class="no-ch">6.4 - Backup por copia de ficheros</a></li>
</ul>
</div>
<div id='topPagination'><div class="pagination noprt"><a href="6_copia_de_seguridad_y_restauracin.html" class="prev"><span>&laquo; </span>Anterior</a> | <a href="62__restauracin_del_dump.html" class="next"> Siguiente<span> &raquo;</span></a></div>
</div><div id="main">
<div id="nodeDecoration"><h1 id="nodeTitle">6.1 - PG_DUMP</h1></div>
<div class="FreeTextIdevice" id="id17">
<div class="iDevice emphasis0">
<div id="ta17_1" class="block" style="display:block;position:relative"><p>
&nbsp;
</p>
<p>
&nbsp;
</p>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Básicamente el método consiste al generar un fichero de texto con
los comandos SQL necesarios para rehacer la Base de Datos tal y como estaba en
el momento de hacer el </span><b><i><span>dump</span></i></b><span style="font-family: Arial; color: black">.<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Utilizaremos el programa </span><b><i><span>pg_dump</span></i></b><span style="font-family: Arial; color: black">, que tiene la siguiente sintaxis:<o:p></o:p></span>
</p>
<div style="border: 1pt solid windowtext; padding: 1pt 4pt; margin-left: 2cm; margin-right: 28.25pt">
<p class="MsoBodyText" style="border: medium none ; padding: 0cm">
<b><span style="font-family: 'Courier New'; color: mediumblue">pg_dump [ opciones ] nombre_bd<o:p></o:p></span></b>
</p>
</div>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">El resultado irá por la salida estándar, la pantalla. Por tanto
seguramente siempre lo gastaremos así:<o:p></o:p></span>
</p>
<div style="border: 1pt solid windowtext; padding: 1pt 4pt; margin-left: 2cm; margin-right: 0cm">
<p class="MsoBodyText" style="border: medium none ; padding: 0cm">
<b><span style="font-family: 'Courier New'; color: mediumblue">pg_dump nombre<i>_bd </i>&gt;
fichero<i>_salida<o:p></o:p></i></span></b>
</p>
</div>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Si queremos que no se guarde en el directorio activo deberemos
poner la ruta también. Como cuestión de estilo, podríamos acostumbrarnos a
poner siempre la extensión </span><b><span>.sql </span></b><span style="font-family: Arial; color: black">Ahora
tendremos en este fichero todas las sentencias SQL para dejar la Base de Datos
como estaba.<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Lo puede ejecutar cualquiera usuario, y sobre cualquier Base de
Datos, pero evidentemente si el usuario no tiene permiso de acceso sobre la
B.D. fallará.<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Como </span><b><i><span>pg_dump es</span></i></b><span style="font-family: Arial; color: black"> una aplicación cliente de
PostgreSQL se podrá ejecutar desde cualquier lugar, en local o remoto. Y la
autenticación será igual que lo que hemos visto hasta ahora.<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Estas son algunas de las opciones:<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<span style="color: blue"> <o:p></o:p></span>
</p>
<p class="MsoBodyText">
<b><span style="font-size: 11pt; color: black">-a <span>                    </span></span></b><span style="font-size: 11pt; color: black">solo</span><span style="font-size: 11pt; font-family: Arial; color: black"> guarda las datos<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<b><span style="font-size: 11pt; color: black">-s <span>                    </span></span></b><span style="font-size: 11pt; color: black">solo</span><span style="font-size: 11pt; font-family: Arial; color: black"> guarda la estructura<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<b><span style="font-size: 11pt; color: black">-d</span></b><span style="font-size: 11pt; color: black"> <span>                   </span>incluye</span><span style="font-size: 11pt; font-family: Arial; color: black"> sentencias INSERT para las datos (sino pondrá
sentencias COPY)<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<b><span style="font-size: 11pt; color: black">-D <span>                   </span></span></b><span style="font-size: 11pt; font-family: Arial; color: black">lo mismo pero explicitando los nombres de las
columnas<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<b><span style="font-size: 11pt; color: black">-f <i>fichero</i></span></b><i><span style="font-size: 11pt; color: black"><span>         </span> envía</span></i><span style="font-size: 11pt; font-family: Arial; color: black"> el resultado en un fichero; si no se
especifica, lo envía en la salida estàndar.<o:p></o:p></span>
</p>
<p class="MsoBodyText" style="margin-left: 70.9pt; text-indent: -70.9pt">
<b><span style="font-size: 11pt; color: black">-F <i>format <span>        </span></i></span></b><span style="font-size: 11pt; font-family: Arial; color: black">indica el formato con que se guardará el fichero (</span><b><span style="font-size: 11pt">p fichero</span></b><span style="font-size: 11pt; font-family: Arial; color: black"> de texto; </span><b><span style="font-size: 11pt">t </span></b><span style="font-size: 11pt; font-family: Arial; color: black">de
tipo tar; </span><b><span style="font-size: 11pt">c </span></b><span style="font-size: 11pt; font-family: Arial; color: black">de tipo custom, que es la más flexible; con el
primero deberemos restaurar utilizando </span><b><i><span style="font-size: 11pt">psql</span></i></b><span style="font-size: 11pt; font-family: Arial; color: black">; con los dos últimos utilizaremos </span><b><i><span style="font-size: 11pt">pg_rerestore</span></i></b><span style="font-size: 11pt; font-family: Arial; color: black">)<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<b><span style="font-size: 11pt; color: black">-n nombre<i> <span>      </span></i></span></b><span style="font-size: 11pt; color: black">incluye</span><span style="font-size: 11pt; font-family: Arial; color: black"> solo el esquema especificado<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<b><span style="font-size: 11pt; color: black">-t nombre<i> <span>       </span></i></span></b><span style="font-size: 11pt; color: black">incluye</span><span style="font-size: 11pt; font-family: Arial; color: black"> solo la tabla especificada<o:p></o:p></span>
</p>
<p class="MsoBodyText" style="margin-right: -14.3pt">
<span style="font-family: Arial; color: black">Aparte estarán las
habituales opciones de conexión: </span><b><span>-h </span></b><span style="font-family: Arial; color: black">(</span><i><span>HOST</span></i><span style="font-family: Arial; color: black">), </span><b><span>-p </span></b><span style="font-family: Arial; color: black">(</span><i><span>puerto</span></i><span style="font-family: Arial; color: black">), </span><b><span>-U </span></b><span style="font-family: Arial; color: black">(</span><i><span>usuario</span></i><span style="font-family: Arial; color: black">) y </span><b><span>-W<o:p></o:p></span></b>
</p>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Esta sería la manera de hacer copia de seguridad de la Base de
Datos </span><b><span>xarxa</span></b><span style="font-family: Arial; color: black">, guardándola en un fichero
del directorio activo renombrado </span><b><span>xarxa.sql</span></b><span style="font-family: Arial; color: black">.<o:p></o:p></span>
</p>
<div style="border: 1pt solid windowtext; padding: 1pt 4pt; margin-left: 2cm; margin-right: 0cm">
<p class="MsoBodyText" style="border: medium none ; padding: 0cm">
<b><i><span style="font-family: 'Courier New'; color: mediumblue">pg_dump -U xarxa &gt;
xarxa.sql</span></i></b><b><span style="font-family: 'Courier New'; color: mediumblue"><o:p></o:p></span></b>
</p>
</div>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Para hacer un </span><b><i><span>dump </span></i></b><span style="font-family: Arial; color: black">no hace falta parar el servidor.<o:p></o:p></span>
</p>
<p class="MsoBodyText">
<span style="font-family: Arial; color: black">Una variante es el </span><b><i><span>pg_dumpall </span></i></b><span style="font-family: Arial; color: black">que hace el dump sobre
todas las bases de datos (seguramente este es el candidato para copias de
seguridad periódicas). Evidentemente lo deberemos hacer como </span><b><i><span>posgres</span></i></b><span style="font-family: Arial; color: black">,
para poder tener acceso a todas las B.D. Tiene el ventaja adicional que también
guarda los objetos que no pertenecen a una determinada Base de Datos, como son
los usuarios. El inconveniente es que deberemos poner la contraseña de posgres</span><b><i><span> tantas</span></i></b><span style="font-family: Arial; color: black">
veces como Bases de Datos tengamos, porque se debe conectar a cada una de
ellas.<o:p></o:p></span>
</p>
<p>

</p>
</div></div>
</div>
<div id='bottomPagination'><div class="pagination noprt"><a href="6_copia_de_seguridad_y_restauracin.html" class="prev"><span>&laquo; </span>Anterior</a> | <a href="62__restauracin_del_dump.html" class="next"> Siguiente<span> &raquo;</span></a></div>
</div></div>
</div>
</body></html>
